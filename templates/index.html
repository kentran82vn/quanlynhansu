<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>- üè´ TR∆Ø·ªúNG M·∫¶M NON HOA H∆Ø·ªöNG D∆Ø∆†NG üéà-</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
<!--
<link href="{{ url_for('static_files', filename='css/styles.css') }}?v=20250716" rel="stylesheet"/>
-->
  <style>
    body {
      background-color: #f5f7fa;
      display: flex;
      min-height: 100vh;
      margin: 0;
    }
    .sidebar {
      background-color: #fff;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      padding: 1rem;
      margin: 10px;
      min-height: calc(100vh - 20px);
      width: 320px;
      flex-shrink: 0;
    }
    .sidebar .nav-link {
      background: linear-gradient(145deg, #e6e6e6, #ffffff);
      border: 1px solid #ccc;
      border-radius: 6px;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.2), -2px -2px 5px rgba(255,255,255,0.5);
      margin: 5px 10px;
      text-align: center;
      font-weight: 500;
      transition: all 0.2s ease-in-out;
    }
    .sidebar .nav-link i {
      font-size: 16px;
    }
    .sidebar .nav-link:hover {
      box-shadow: inset 2px 2px 5px rgba(0,0,0,0.2), inset -2px -2px 5px rgba(255,255,255,0.5);
      background-color: #f1f1f1;
      transform: translateY(1px);
      text-decoration: none;
    }
    .sidebar .nav-link.active {
      background-color: #0d6efd;
      color: rgb(0, 0, 0);
      border-left: 3px solid #ff0000;
      font-weight: 600;
    }
    .sidebar .nav-link.active i {
      color: rgb(233, 11, 11);
    }
    .sidebar .nav-link.text-danger {
      color: #dc3545;
    }
    .sidebar .nav-link.text-danger:hover {
      background-color: #f8d7da;
      color: #c82333;
    }
    iframe {
      width: 100%;
      height: calc(100vh - 56px);
      border: none;
    }
    .topbar {
      height: 56px;
      background: #fff;
      border-bottom: 1px solid #dee2e6;
      padding: 0 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .topbar .user-info {
      font-weight: 500;
      color: #495057;
    }
    body {
      display: flex;
      min-height: 100vh;
      margin: 0;
    }
    .content {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-width: 0;
    }
  </style>
</head>
<body>
    <div class="container-fluid">
      <div class="row">
            <nav class="col-md-2 d-none d-md-block sidebar">
                <div style="text-align:center; margin-bottom:10px;">
                  <img src="/static/mnhhd.jpg" alt="Logo" style="width:50px; height:auto; margin-bottom:5px;">
                  <h4 id="info-title" style="
                    margin: 5px 0;
                    font-family: 'Segoe UI', Arial, sans-serif;
                    font-size: 20px;
                    font-weight: 700;
                    letter-spacing: 1px;
                    text-transform: uppercase;
                    color: #4509b4;
                    text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
                  ">
                    --- B·∫¢NG ƒêI·ªÄU KHI·ªÇN ---
                  </h4>
                </div>

                <div class="position-sticky">
                  <ul class="nav flex-column">
                        <li class="nav-item">
                          <a class="nav-link active" data-page="/employees" href="#">
                            <i class="fas fa-users"></i> Trang Ch√≠nh
                          </a>
                        </li>
                        {% if session['role'] == 'user' or session['role'] == 'supervisor' %}
                        <li class="nav-item">
                          <a class="nav-link" data-page="/user-epa-score" href="#">
                            <i class="fas fa-chart-line"></i> ƒê√°nh Gi√° EPA
                          </a>
                        </li>
                        {% endif %}
                        {% if session['role'] == 'admin' or session['user'] == 'kimnhung' %}
                        <li class="nav-item">
                          <a class="nav-link" data-page="/users" href="#">
                            <i class="fas fa-user-shield"></i> Qu·∫£n L√Ω T√†i Kho·∫£n
                          </a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" data-page="/classes" href="#">
                            <i class="fas fa-school"></i> Danh S√°ch L·ªõp
                          </a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" data-page="/assign-classes" href="#">
                            <i class="fas fa-user-plus"></i> Ph√¢n L·ªõp H·ªçc Sinh
                          </a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" data-page="/assign-teachers" href="#">
                            <i class="fas fa-chalkboard-teacher"></i> Ph√¢n C√¥ng Gi√°o Vi√™n
                          </a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" data-page="/data_epa" href="#">
                            <i class="fas fa-chart-line"></i> ƒê√°nh Gi√° Gi√°o Vi√™n
                          </a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" data-page="/epa_summary" href="#">
                            <i class="fas fa-chart-line"></i> X·∫øp H·∫°ng ƒê√°nh Gi√°
                          </a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" data-page="/thoigianmoepa" href="#">
                            <i class="fas fa-scroll"></i> ƒê·∫∑t Th·ªùi Gian ƒê√°nh Gi√°
                          </a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" data-page="/admin/questions" href="#">
                            <i class="fas fa-scroll"></i> C√¢u H·ªèi ƒê√°nh Gi√°
                          </a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" data-page="/logs" href="#">
                            <i class="fas fa-scroll"></i> Nh·∫≠t K√Ω Thay ƒê·ªïi
                          </a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" data-page="/stats" href="#">
                            <i class="fas fa-chart-bar"></i> Th√¥ng Tin Th·ªëng K√™
                          </a>
                        </li>
                        {% endif %}

                        <li class="nav-item mt-4">
                          <a class="nav-link text-danger" href="/logout">
                            <i class="fas fa-sign-out-alt"></i> ƒêƒÉng Xu·∫•t
                          </a>
                        </li>
                </ul>
                </div>
            </nav>
          <main class="col-md-10 ms-sm-auto px-0">
          <div class="topbar">
                <h5 class="mb-3 d-flex align-items-center gap-2">
                  <img src="/static/mnhhd.jpg" alt="Logo" style="width:30px; height:auto;">
                  <span>- TR∆Ø·ªúNG M·∫¶M NON HOA H∆Ø·ªöNG D∆Ø∆†NG -</span>
                </h5>
                <div class="user-actions d-flex align-items-center justify-content-end gap-2">
                  <a class="btn btn-outline-secondary btn-sm" href="/dashboard">
                  üè† Trang Ch·ªß
                  </a>
                  <button class="btn btn-outline-secondary btn-sm" onclick="openChangePassModal()">
                  üîê ƒê·ªïi M·∫≠t Kh·∫©u
                  </button>
                  <div class="user-info">
                  üë§ <span id="currentUser">{{ user }} ({{ role }})</span>
                  </div>
                </div>
          </div>
              <iframe id="mainFrame" src="/employees"></iframe>
          </main>
      </div>
    </div>
    <!-- üîß Modal ƒë·ªïi m·∫≠t kh·∫©u user -->
    <div aria-hidden="true" aria-labelledby="changePassModalLabel" class="modal fade" id="changePassModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="changePassModalLabel">ƒê·ªïi M·∫≠t Kh·∫©u</h5>
            <button class="btn-close" data-bs-dismiss="modal" type="button"></button>
          </div>
          <div class="modal-body">
            <form id="changePassForm">
              <div class="mb-3">
              <label>M·∫≠t kh·∫©u hi·ªán t·∫°i</label>
              <input class="form-control" id="oldPassword" required="" type="password"/>
              </div>
              <div class="mb-3">
              <label>M·∫≠t kh·∫©u m·ªõi</label>
              <input class="form-control" id="newPassword" required="" type="password"/>
              </div>
              <div class="mb-3">
                <label>X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi</label>
                <input class="form-control" id="confirmNewPassword" required="" type="password"/>
              </div>
              </form>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
            <button class="btn btn-primary" onclick="submitChangePassword()">ƒê·ªïi M·∫≠t Kh·∫©u</button>
          </div>
        </div>
      </div>
    </div>
<script>
  let schemaByDept = {};
  const currentUser = "{{ user|lower }}";
  const userRole = "{{ role }}";
  
  document.querySelectorAll('.nav-link[data-page]').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
      this.classList.add('active');
      document.getElementById('mainFrame').src = this.getAttribute('data-page');
    });
  });

  function openChangePassModal() {
    document.getElementById('changePassForm').reset();
    const modal = new bootstrap.Modal(document.getElementById('changePassModal'));
    modal.show();
  }

  async function submitChangePassword() {
    const oldPass = document.getElementById('oldPassword').value.trim();
    const newPass = document.getElementById('newPassword').value.trim();
    const confirmPass = document.getElementById('confirmNewPassword').value.trim();

    if (!oldPass || !newPass || !confirmPass) {
      alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!");
      return;
    }

    if (newPass !== confirmPass) {
      alert("M·∫≠t kh·∫©u m·ªõi kh√¥ng tr√πng kh·ªõp!");
      return;
    }

    const payload = { old_password: oldPass, new_password: newPass };

    try {
      const res = await fetch('/change-password', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      const result = await res.json();
      if (result.status === 'success') {
        alert("‚úÖ ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng!");
        bootstrap.Modal.getInstance(document.getElementById('changePassModal')).hide();
      } else {
        alert("‚ùå ƒê·ªïi m·∫≠t kh·∫©u th·∫•t b·∫°i: " + (result.message || "Kh√¥ng r√µ l·ªói"));
      }
    } catch (err) {
      console.error(err);
      alert("‚ùå L·ªói k·∫øt n·ªëi server!");
    }
  }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
